<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>任務面板 MVP｜修正版 v1.1</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />
    <link href="./assets/styles/main.css" rel="stylesheet" />
  </head>
  <body>
    <div class="stage">
      <div class="screen">
        <!-- Topbar -->
        <div class="topbar">
          <div class="navBtns">
            <button class="navBtn active" id="btnViewDashboard">任務面板</button>
            <button class="navBtn" id="btnViewCharacter">角色介面</button>
            <button class="navBtn" id="btnViewUpload">角色上傳</button>
            <button class="navBtn" id="btnViewSettings">個人資料</button>
          </div>
          <div class="topStats">
            <span class="chip" id="chipUser">Lv.1 / 0%</span>
            <span class="chip" id="chipCoins">金幣 0</span>
            <span class="chip" id="chipCards">刷新卡 x0</span>
          </div>
        </div>

        <!-- Mini notification -->
        <div class="notifyMini">
          <span class="badge">!</span>
          <div class="ttl" id="ttlNotif">通知</div>
          <ul id="notifMain"></ul>
          <button class="langBtn" id="btnLang">中 / EN</button>
        </div>

        <!-- 視圖：任務面板 -->
        <div id="viewDashboard">
          <div class="cols">
            <div class="panel">
              <h2><span id="hCharacter">角色概況</span></h2>

              <!-- 固定顯示的四個欄位 -->
              <div class="meta" id="meta">
                <div><span>姓名</span><strong>-</strong></div>
                <div><span>身分</span><strong>-</strong></div>
                <div><span>年級</span><strong>-</strong></div>
                <div><span>Lv.</span><strong>1</strong></div>
              </div>

              <div class="xp">
                <div id="lblXP">角色經驗</div>
                <div class="bar" id="charXPWrap"><i id="charXP" data-w="0"></i></div>
                <div id="charXPNum">0%</div>
              </div>

              <h2 id="hSkills">技能與經驗</h2>
              <div id="skills"></div>

              <!-- 作題區 -->
              <div id="problemArea" class="panel">
                <h2 id="hProblems">作題區</h2>
                <div id="problemBox" class="problemBox">
                  <h3 id="problemTitle">請從右側任務選擇一題開始作答</h3>
                  <div id="problemBody" class="problemBody"></div>
                  <div id="problemExplain" class="msg"></div>
                  <div id="problemMsg" class="msg"></div>
                  <div class="problemActions">
                    <button class="btn small" id="btnClearAns">清除</button>
                    <button class="btn small" id="btnSubmitAns">提交</button>
                  </div>
                </div>
              </div>
            </div>

            <div style="display: grid; gap: 12px">
              <div class="panel">
                <h2 id="hDaily">
                  核心任務 <span class="sm" id="hDailySub">（每日 20:00 刷新）</span>
                  <span>
                    <button class="btn" id="btnRefreshDaily">
                      刷新任務（卡 x<span id="cardCountA">0</span>）
                    </button>
                  </span>
                </h2>
                <div id="tasks"></div>
              </div>

              <div class="panel">
                <h2 id="hSide">
                  日常任務
                  <span><button class="btn" id="btnRerollSide">更新</button></span>
                </h2>
                <div id="side"></div>
              </div>

              <div class="panel">
                <h2 id="hShop">卡片 / 商城</h2>
                <div class="sm" id="shopDesc">
                  刷新卡可用於重新抽核心任務。升級與連續登入可獲得卡片。
                </div>
                <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap">
                  <button class="btn" id="btnBuy1">買刷新卡 x1（100 金幣）</button>
                  <button class="btn" id="btnBuy5">買刷新卡 x5（450 金幣）</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 視圖：角色介面 -->
        <div id="viewCharacter" class="hidden">
          <div class="charStage">
            <div class="charRing"></div>
            <div class="charWrap" id="charWrap">
              <img id="avatarImg" class="avatar hidden" alt="角色圖片" />
              <svg id="avatarSVG" class="avatar" viewBox="0 0 256 256">
                <!-- 省略角色 SVG 預設圖形 -->
              </svg>
            </div>
          </div>
        </div>

        <!-- 視圖：角色上傳 -->
        <div id="viewUpload" class="hidden">
          <div class="panel uploadPanel">
            <h2 id="hUpload">上傳角色圖片</h2>
            <div class="field">
              <label id="lblChoose">選擇圖片</label>
              <input type="file" id="avatarInput" accept="image/*" />
            </div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap">
              <button class="btn" id="btnApplyAvatar">套用至角色介面</button>
              <button class="btn" id="btnClearAvatar">移除自訂圖片</button>
            </div>
            <div class="sm" style="opacity: 0.8; margin-top: 6px" id="uploadHint">
              圖片將以 base64 儲存於本機（localStorage），不會上傳到網路。
            </div>
          </div>
        </div>

        <!-- 視圖：個人資料 -->
        <div id="viewSettings" class="hidden">
          <div class="panel">
            <h2 id="hProfile">個人資料</h2>
            <div class="meta" id="metaSettings"></div>
            <div
              style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; margin-top: 8px"
            >
              <div class="field">
                <label id="lblName">姓名</label>
                <input id="inputName" placeholder="" />
              </div>
              <div class="field">
                <label id="lblGrade">年級</label>
                <select id="selectRank">
                  <option>五年級</option>
                  <option>六年級</option>
                  <option>國一生</option>
                  <option>國二生</option>
                  <option>國三生</option>
                </select>
              </div>
            </div>

            <!-- 技能面板 + 雷達圖 -->
            <div id="profileWrap">
              <div class="radarPanel">
                <h3 id="lblRadar">能力雷達圖</h3>
                <canvas id="radar" width="320" height="220"></canvas>
              </div>
              <div id="profileSkills">
                <h3 id="lblSkillPanel">技能一覽</h3>
                <div id="profileSkillsList"></div>
              </div>
            </div>

            <!-- 套用 / 重置 -->
            <div style="margin-top: 16px; display: flex; gap: 8px;">
              <button class="btn" id="btnApplyBottom">套用</button>
              <button class="btn" id="btnResetBottom">重置所有資料</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script defer src="./assets/scripts/app.js"></script>
  </body>
</html>
